<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SeaConnect Feeds</title>

<style>

body{
margin:0;
font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;
background:linear-gradient(180deg,#0f172a,#1e293b);
color:#f1f5f9;
}

.page{
display:none;
padding:20px;
padding-bottom:95px;
}

.card{
background:rgba(255,255,255,0.06);
backdrop-filter:blur(12px);
border:1px solid rgba(255,255,255,0.08);
padding:18px;
border-radius:22px;
margin-bottom:16px;
box-shadow:0 10px 30px rgba(0,0,0,.35);
}

input,textarea{
width:100%;
padding:12px;
border-radius:14px;
border:1px solid rgba(255,255,255,0.15);
margin-top:6px;
box-sizing:border-box;
background:rgba(255,255,255,0.05);
color:#fff;
}

textarea{
min-height:90px;
}

button{
padding:11px 16px;
border:none;
border-radius:14px;
font-weight:700;
cursor:pointer;
}

.primary{
background:linear-gradient(135deg,#3b82f6,#2563eb);
color:#fff;
}

.light{
background:rgba(255,255,255,0.1);
color:#fff;
}

.danger{
background:linear-gradient(135deg,#ef4444,#dc2626);
color:#fff;
}

.row{
display:flex;
gap:10px;
margin-top:12px;
}

.feedPhoto{
width:100%;
margin-top:10px;
border-radius:16px;
}

.comment{
padding:8px;
margin-top:6px;
background:rgba(255,255,255,0.06);
border-radius:12px;
font-size:13px;
}

.topbar{
display:flex;
justify-content:space-between;
align-items:center;
margin-bottom:12px;
}

.title{
font-size:22px;
font-weight:900;
}

.likeBtn{
background:rgba(255,255,255,0.08);
color:#fff;
}

.likeBtn.liked{
background:rgba(59,130,246,0.25);
}

.subText{
font-size:13px;
color:#94a3b8;
}

</style>
</head>

<body>

<!-- LOGIN PAGE -->

<div id="loginPage" class="page" style="display:block;">

<div class="card">

<h2>SeaConnect Login</h2>

<input id="loginEmail" placeholder="Email">

<input id="loginPassword" type="password" placeholder="Password">

<div class="row">
<button class="primary" onclick="login()">Login</button>
<button class="light" onclick="signup()">Sign Up</button>
</div>

</div>

</div>

<!-- FEEDS PAGE -->

<div id="feedsPage" class="page">

<div class="topbar">
<div>
<div class="title">üì∞ Crew Feeds</div>
<div class="subText">Logged in as: <span id="who"></span></div>
</div>

<button class="danger" onclick="logout()">Logout</button>
</div>

<!-- CREATE POST -->

<div class="card">

<div style="font-weight:900;margin-bottom:8px;">Create Post</div>

<textarea id="feedInput" placeholder="What‚Äôs happening on board?"></textarea>

<input type="file" id="feedPhoto" accept="image/*">

<img id="previewPhoto"
style="width:100%;margin-top:10px;border-radius:16px;display:none;">

<div class="row">
<button class="primary" onclick="createFeed()">Post</button>
</div>

<div id="postMsg" class="subText"></div>

</div>

<div id="feedsList"></div>

</div>

<script type="module">

import { initializeApp }
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";

import {
getAuth,
onAuthStateChanged,
signOut,
signInWithEmailAndPassword,
createUserWithEmailAndPassword
}
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

import {
getFirestore,
collection,
addDoc,
query,
orderBy,
onSnapshot,
doc,
getDoc,
deleteDoc,
updateDoc,
where
}
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig={
apiKey:"AIzaSyCNlodsmEHrSXxgH0gTOcx4cAXwG8qmG9w",
authDomain:"seaconnect-d2baa.firebaseapp.com",
projectId:"seaconnect-d2baa"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

const IMGBB_KEY="5b417e8de4a883f7425eeda12dc38f06";

let currentUID=null;
let currentEmail="";
let currentName="Crew";

const feedsList=document.getElementById("feedsList");
const who=document.getElementById("who");

onAuthStateChanged(auth,(user)=>{

if(!user){

document.getElementById("loginPage").style.display="block";
document.getElementById("feedsPage").style.display="none";
return;

}

document.getElementById("loginPage").style.display="none";
document.getElementById("feedsPage").style.display="block";

currentUID=user.uid;
currentEmail=user.email;

who.innerText=currentEmail;

loadFeeds();

});

window.login=async function(){

const email=document.getElementById("loginEmail").value;
const password=document.getElementById("loginPassword").value;

try{

await signInWithEmailAndPassword(auth,email,password);

}catch(e){

alert(e.message);

}

}

window.signup=async function(){

const email=document.getElementById("loginEmail").value;
const password=document.getElementById("loginPassword").value;

try{

await createUserWithEmailAndPassword(auth,email,password);

alert("Account created. Now login.");

}catch(e){

alert(e.message);

}

}

window.logout=async function(){

await signOut(auth);
location.reload();

}

window.createFeed=async function(){

const text=document.getElementById("feedInput").value.trim();
const file=document.getElementById("feedPhoto").files[0];

if(!text && !file){

alert("Write something or choose a photo");
return;

}

let photoURL="";

if(file){

const formData=new FormData();
formData.append("image",file);

const res=await fetch(
"https://api.imgbb.com/1/upload?key="+IMGBB_KEY,
{method:"POST",body:formData}
);

const data=await res.json();

if(data.success){
photoURL=data.data.url;
}

}

await addDoc(collection(db,"feeds"),{

uid:currentUID,
email:currentEmail,
name:currentEmail.split("@")[0],
text:text,
photo:photoURL,
likes:[],
createdAt:Date.now()

});

document.getElementById("feedInput").value="";
document.getElementById("feedPhoto").value="";
document.getElementById("previewPhoto").style.display="none";

}

function loadFeeds(){

const q=query(collection(db,"feeds"),orderBy("createdAt","desc"));

onSnapshot(q,(snap)=>{

feedsList.innerHTML="";

snap.forEach(docSnap=>{

const d=docSnap.data();
const id=docSnap.id;

const likesArr=d.likes||[];
const liked=likesArr.includes(currentUID);

feedsList.innerHTML+=`

<div class="card">

<div style="display:flex;gap:10px;align-items:center;">

<img src="https://i.ibb.co/2kRZ7Z6/avatar.png"
style="width:40px;height:40px;border-radius:50%;">

<div>
<div style="font-weight:900">${d.name}</div>
<div class="subText">${d.email}</div>
</div>

</div>

<div style="margin-top:10px">${d.text||""}</div>

${d.photo?`<img src="${d.photo}" class="feedPhoto">`:""}

<div class="row">

<button class="likeBtn ${liked?"liked":""}"
onclick="toggleLike('${id}')">

${liked?"üíô Liked":"üëç Like"}

</button>

<span class="subText">${likesArr.length} likes</span>

${d.uid===currentUID?`
<button class="danger" onclick="deletePost('${id}')">Delete</button>
`:""}

</div>

<div style="margin-top:10px">

<input id="commentInput-${id}" placeholder="Write comment">

<button onclick="sendComment('${id}')">Send</button>

<div id="comments-${id}"></div>

</div>

</div>

`;

loadComments(id);

});

});

}

window.toggleLike=async function(id){

const ref=doc(db,"feeds",id);
const snap=await getDoc(ref);

let likes=snap.data().likes||[];

if(likes.includes(currentUID)){
likes=likes.filter(x=>x!==currentUID);
}else{
likes.push(currentUID);
}

await updateDoc(ref,{likes});

}

window.deletePost=async function(id){

if(confirm("Delete post?")){
await deleteDoc(doc(db,"feeds",id));
}

}

window.sendComment=async function(feedId){

const input=document.getElementById("commentInput-"+feedId);
const text=input.value.trim();

if(!text) return;

await addDoc(collection(db,"comments"),{

feedId:feedId,
uid:currentUID,
name:currentEmail.split("@")[0],
text:text,
createdAt:Date.now()

});

input.value="";

}

function loadComments(feedId){

const q=query(collection(db,"comments"),where("feedId","==",feedId));

onSnapshot(q,(snap)=>{

const box=document.getElementById("comments-"+feedId);
if(!box) return;

box.innerHTML="";

snap.forEach(docSnap=>{

const d=docSnap.data();

box.innerHTML+=`
<div class="comment">
<b>${d.name}</b>: ${d.text}
</div>
`;

});

});

}

document.getElementById("feedPhoto").addEventListener("change",function(){

const file=this.files[0];
if(!file) return;

const reader=new FileReader();

reader.onload=function(e){

document.getElementById("previewPhoto").src=e.target.result;
document.getElementById("previewPhoto").style.display="block";

};

reader.readAsDataURL(file);

});

</script>

</body>
</html>
