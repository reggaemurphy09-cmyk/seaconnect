üì∞ Crew Feeds
Create Post
Post
üë• Friends
Friends feature coming soon
üí¨ Messages
Messenger coming soon
üì∞ Feeds
üë• Friends
üí¨ Messages
üë§ Profile


import { initializeApp } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";

import {
getAuth,
onAuthStateChanged
}
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

import {
getFirestore,
collection,
addDoc,
query,
orderBy,
onSnapshot,
doc,
getDoc,
deleteDoc,
updateDoc,
where
}
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig={
apiKey:"AIzaSyCNlodsmEHrSXxgH0gTOcx4cAXwG8qmG9w",
authDomain:"seaconnect-d2baa.firebaseapp.com",
projectId:"seaconnect-d2baa"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

const IMGBB_KEY="5b417e8de4a883f7425eeda12dc38f06";

let currentUID=null;
let currentEmail="";
let isPosting=false;

const feedsList=document.getElementById("feedsList");

/* NAV */

window.showPage=function(id,btn){

document.querySelectorAll(".page")
.forEach(p=>p.style.display="none");

document.querySelectorAll(".bottomnav button")
.forEach(b=>b.classList.remove("active"));

document.getElementById(id).style.display="block";

if(btn) btn.classList.add("active");

};

/* AUTH */

onAuthStateChanged(auth,async(user)=>{

if(!user){
location.href="index.html";
return;
}

currentUID=user.uid;
currentEmail=user.email;

/* SET ONLINE */

await updateDoc(doc(db,"users",currentUID),{
online:true,
lastSeen:Date.now()
});

showPage("feedsPage");

loadFeeds();

});

/* SET OFFLINE WHEN LEAVING */

window.addEventListener("beforeunload",async()=>{

if(currentUID){
await updateDoc(doc(db,"users",currentUID),{
online:false,
lastSeen:Date.now()
});
}

});

/* CREATE POST */

window.createFeed=async function(){

if(isPosting) return;

const btn=document.getElementById("postBtn");
const msg=document.getElementById("postMsg");

isPosting=true;

btn.disabled=true;
btn.innerText="Posting...";
msg.innerText="Uploading...";

try{

const text=document.getElementById("feedInput").value.trim();
const file=document.getElementById("feedPhoto").files[0];

let photoURL="";

if(file){

const formData=new FormData();
formData.append("image",file);

const res=await fetch(
"https://api.imgbb.com/1/upload?key="+IMGBB_KEY,
{method:"POST",body:formData}
);

const data=await res.json();

if(data.success){
photoURL=data.data.url;
}

}

const userSnap=await getDoc(doc(db,"users",currentUID));
const userData=userSnap.data()||{};

await addDoc(collection(db,"feeds"),{

uid:currentUID,
name:userData.name || currentEmail.split("@")[0],
rank:userData.rank || "",
photoProfile:userData.photo || "",
text:text,
photo:photoURL,
likes:[],
createdAt:Date.now()

});

document.getElementById("feedInput").value="";
document.getElementById("feedPhoto").value="";
document.getElementById("previewPhoto").style.display="none";

msg.innerText="‚úÖ Posted";

btn.disabled=false;
btn.innerText="Post";

isPosting=false;

setTimeout(()=>msg.innerText="",2000);

}catch(e){

alert("Post failed");

btn.disabled=false;
btn.innerText="Post";

isPosting=false;

}

};

/* LOAD FEEDS */

function loadFeeds(){

const q=query(collection(db,"feeds"),orderBy("createdAt","desc"));

onSnapshot(q,(snap)=>{

feedsList.innerHTML="";

snap.forEach(async docSnap=>{

const d=docSnap.data();
const id=docSnap.id;

const likesArr=d.likes||[];
const liked=likesArr.includes(currentUID);

/* GET ONLINE STATUS */

let online=false;

try{
const userSnap=await getDoc(doc(db,"users",d.uid));
const userData=userSnap.data();
online=userData?.online || false;
}catch{}

feedsList.innerHTML+=`

<div class="card">

<div style="display:flex;gap:10px;align-items:center;">

<img src="${d.photoProfile || 'https://i.ibb.co/2kRZ7Z6/avatar.png'}"
class="avatar ${online ? 'online' : ''}">

<div>
<div style="font-weight:900">${d.name}</div>
<div class="subText">${d.rank || ""}</div>
</div>

</div>

<div style="margin-top:10px">${d.text||""}</div>

${d.photo?`<img src="${d.photo}" class="feedPhoto">`:""}

<div class="row">

<button class="likeBtn ${liked?"liked":""}"
onclick="toggleLike('${id}')">

${liked?"üíô Liked":"üëç Like"}

</button>

<span class="subText">${likesArr.length} likes</span>

${d.uid===currentUID?`
<button class="danger" onclick="deletePost('${id}')">Delete</button>
`:""}

</div>

<div style="margin-top:10px">

<input id="commentInput-${id}" placeholder="Write comment">

<button onclick="sendComment('${id}')">Send</button>

<div id="comments-${id}"></div>

</div>

</div>

`;

loadComments(id);

});

});

}

/* LIKE */

window.toggleLike=async function(id){

const ref=doc(db,"feeds",id);
const snap=await getDoc(ref);

let likes=snap.data().likes||[];

if(likes.includes(currentUID)){
likes=likes.filter(x=>x!==currentUID);
}else{
likes.push(currentUID);
}

await updateDoc(ref,{likes});

};

/* DELETE POST */

window.deletePost=async function(id){

if(confirm("Delete post?")){
await deleteDoc(doc(db,"feeds",id));
}

};

/* COMMENTS */

window.sendComment=async function(feedId){

const input=document.getElementById("commentInput-"+feedId);
const text=input.value.trim();

if(!text) return;

await addDoc(collection(db,"comments"),{

feedId:feedId,
uid:currentUID,
name:"User",
text:text,
createdAt:Date.now()

});

input.value="";

};

function loadComments(feedId){

const q=query(collection(db,"comments"),where("feedId","==",feedId));

onSnapshot(q,(snap)=>{

const box=document.getElementById("comments-"+feedId);

if(!box) return;

box.innerHTML="";

snap.forEach(docSnap=>{

const d=docSnap.data();

box.innerHTML+=`

<div class="comment">

<div>
<b>${d.name}</b>: ${d.text}
</div>

${d.uid===currentUID?`
<button class="danger"
onclick="deleteComment('${docSnap.id}')">
Delete
</button>
`:""}

</div>

`;

});

});

}

window.deleteComment=async function(id){

if(confirm("Delete comment?")){
await deleteDoc(doc(db,"comments",id));
}

};

/* IMAGE PREVIEW */

document.getElementById("feedPhoto").addEventListener("change",function(){

const file=this.files[0];

if(!file) return;

const reader=new FileReader();

reader.onload=function(e){

document.getElementById("previewPhoto").src=e.target.result;
document.getElementById("previewPhoto").style.display="block";

};

reader.readAsDataURL(file);

});

